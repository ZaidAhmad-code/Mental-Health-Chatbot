<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serene - AI Mental Health Assistant</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/images/serene.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header class="header">
        <div class="header-content">
            <div class="logo" onclick="location.reload()">
                <img src="/static/images/serene.png" alt="Serene" class="logo-img">
                <span class="logo-text">Serene</span>
            </div>
            
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
                
                <a href="#" class="nav-btn" onclick="openWellnessModal(); return false;">
                    <span>ğŸ§˜</span>
                    <span class="nav-btn-text">Wellness</span>
                </a>
                
                <a href="/assessments" class="nav-btn">
                    <span>ğŸ“‹</span>
                    <span class="nav-btn-text">Assessments</span>
                </a>
                
                <div class="status-badge">
                    <span class="status-dot"></span>
                    <span>Online</span>
                </div>
                
                <!-- Auth Section -->
                <div class="auth-section" id="auth-section">
                    <!-- Guest State -->
                    <div class="auth-guest" id="auth-guest">
                        <a href="/login" class="auth-btn login-btn">
                            <span>ğŸ”</span>
                            <span>Login</span>
                        </a>
                        <a href="/login" class="auth-btn register-btn">
                            <span>âœ¨</span>
                            <span>Sign Up</span>
                        </a>
                    </div>
                    
                    <!-- Logged In State -->
                    <div class="auth-user" id="auth-user" style="display: none;">
                        <div class="user-profile-btn" id="user-profile-btn">
                            <div class="user-avatar-small">ğŸ‘¤</div>
                            <span class="user-name" id="user-name-display">User</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-avatar">ğŸ‘¤</div>
                                <div class="dropdown-info">
                                    <div class="dropdown-name" id="dropdown-name">User Name</div>
                                    <div class="dropdown-email" id="dropdown-email">user@email.com</div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" onclick="openDashboard()">
                                <span>ğŸ“Š</span> Dashboard
                            </a>
                            <a href="#" class="dropdown-item" onclick="openProfile()">
                                <span>ğŸ‘¤</span> My Profile
                            </a>
                            <a href="#" class="dropdown-item" onclick="openSettings()">
                                <span>âš™ï¸</span> Settings
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item logout-item" onclick="logout()">
                                <span>ğŸšª</span> Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ==================== MAIN CONTAINER ==================== -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="chat-sidebar" id="chat-sidebar">
            <div class="sidebar-header">
                <h3>ğŸ’¬ Conversations</h3>
                <button class="new-chat-btn" onclick="createNewChat()" title="New Chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <div class="chat-list" id="chat-list">
                <!-- Chat sessions loaded dynamically -->
            </div>
        </aside>
        
        <!-- Sidebar Toggle -->
        <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Main Chat Area -->
        <main class="main-content">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <span id="current-chat-title">New Chat</span>
                    <button class="edit-title-btn" onclick="editChatTitle()" title="Edit title">âœï¸</button>
                </div>
                
                <!-- Chat Log -->
                <div id="chat-log">
                    <div class="welcome-message">
                        <h2 class="welcome-title">Welcome to Serene</h2>
                        <p class="welcome-subtitle">Your AI-powered mental health companion. Share your thoughts in a safe, supportive space.</p>
                        <div class="quick-actions">
                            <button class="quick-btn" onclick="quickQuery('I\'m feeling anxious')">ğŸ˜° Feeling Anxious</button>
                            <button class="quick-btn" onclick="quickQuery('I need coping strategies')">ğŸ§˜ Coping Strategies</button>
                            <button class="quick-btn" onclick="quickQuery('How can I improve my mood?')">ğŸ˜Š Mood Help</button>
                        </div>
                    </div>
                </div>
                
                <!-- Input Area -->
                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea id="user-input" placeholder="Share what's on your mind..." rows="1"></textarea>
                    </div>
                    <button id="send-button">Send</button>
                </div>
            </div>
        </main>
    </div>

    <!-- ==================== EMERGENCY BUTTON ==================== -->
    <button class="emergency-btn">ğŸ†˜ Emergency</button>
    <div class="emergency-card">
        <h3>ğŸ†˜ Need Immediate Help?</h3>
        <p class="emergency-note">If you're in crisis, please reach out to these Sri Lankan services:</p>
        
        <div class="contact-item">
            <span class="contact-icon">ğŸ“</span>
            <div>
                <strong>Emergency Services</strong>
                <a href="tel:119">119</a> (Police, Fire, Ambulance)
            </div>
        </div>
        
        <div class="contact-item">
            <span class="contact-icon">ğŸ¥</span>
            <div>
                <strong>Suwa Seriya Ambulance</strong>
                <a href="tel:1990">1990</a> (Free 24/7)
            </div>
        </div>
        
        <div class="contact-item">
            <span class="contact-icon">ğŸ’š</span>
            <div>
                <strong>Sumithrayo (Suicide Prevention)</strong>
                <a href="tel:+94112682535">+94 11 268 2535</a>
            </div>
        </div>
        
        <div class="contact-item">
            <span class="contact-icon">ğŸ§ </span>
            <div>
                <strong>National Institute of Mental Health</strong>
                <a href="tel:+94112696211">+94 11 269 6211</a>
            </div>
        </div>
        
        <div class="contact-item">
            <span class="contact-icon">â˜ï¸</span>
            <div>
                <strong>Mental Health Helpline</strong>
                <a href="tel:1926">1926</a> (24/7 Support)
            </div>
        </div>
        
        <p class="emergency-disclaimer">Remember: You're not alone. Help is always available. ğŸ’™</p>
    </div>

    <!-- ==================== WELLNESS MODAL ==================== -->
    <div id="wellness-modal" class="modal">
        <div class="modal-content wellness-modal">
            <span class="close" onclick="closeWellnessModal()">&times;</span>
            <h2>ğŸ§˜ Wellness Resources</h2>
            <p>Explore these evidence-based wellness activities to support your mental health and well-being. Take a moment for yourself today.</p>
            
            <div class="wellness-grid">
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸŒ¬ï¸</div>
                    <h3>Breathing Exercises</h3>
                    <p>Try box breathing: Inhale for 4, hold for 4, exhale for 4, hold for 4. Repeat.</p>
                    <button onclick="startBreathingExercise()">Start Exercise</button>
                </div>
                
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸµ</div>
                    <h3>Calming Music</h3>
                    <p>Listen to soothing sounds and music to help reduce stress and anxiety.</p>
                    <button onclick="window.open('https://www.calm.com', '_blank')">Explore</button>
                </div>
                
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸ“</div>
                    <h3>Journaling</h3>
                    <p>Express your thoughts and feelings through writing. It can be therapeutic.</p>
                    <button onclick="openJournal()">Start Journaling</button>
                </div>
                
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸš¶</div>
                    <h3>Mindful Walking</h3>
                    <p>Take a short walk and focus on your surroundings. Notice the details.</p>
                    <button onclick="alert('Take a 10-minute mindful walk. Focus on your breath and surroundings.')">Learn More</button>
                </div>
                
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸ’¤</div>
                    <h3>Sleep Hygiene</h3>
                    <p>Tips for better sleep: consistent schedule, cool room, no screens before bed.</p>
                    <button onclick="showSleepTips()">View Tips</button>
                </div>
                
                <div class="wellness-card">
                    <div class="wellness-icon">ğŸ™</div>
                    <h3>Gratitude Practice</h3>
                    <p>List three things you're grateful for today. Gratitude boosts mood.</p>
                    <button onclick="startGratitude()">Start Practice</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== BREATHING EXERCISE MODAL ==================== -->
    <div id="breathing-modal" class="modal">
        <div class="modal-content small-modal">
            <span class="close" onclick="closeModal('breathing-modal')">&times;</span>
            <div style="text-align: center;">
                <div style="font-size: 64px; margin-bottom: 20px;">ğŸŒ¬ï¸</div>
                <h2>Box Breathing Exercise</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">A simple 4-4-4-4 breathing technique to calm your mind</p>
                
                <div id="breathing-guide" style="margin: 40px 0;">
                    <div id="breathing-circle" style="width: 120px; height: 120px; border-radius: 50%; background: var(--accent); margin: 0 auto; transition: transform 4s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 600;"></div>
                    <div id="breathing-text" style="margin-top: 24px; font-size: 18px; font-weight: 600; color: var(--text-primary);"></div>
                </div>
                
                <button onclick="startBreathingCycle()" style="padding: 12px 32px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer; font-size: 16px;">Start Exercise</button>
            </div>
        </div>
    </div>

    <!-- ==================== JOURNAL MODAL ==================== -->
    <div id="journal-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('journal-modal')">&times;</span>
            <h2>ğŸ“ Journal Entry</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Express your thoughts and feelings. Writing can be therapeutic and help you process emotions.</p>
            
            <textarea id="journal-text" placeholder="What's on your mind today?" style="width: 100%; min-height: 200px; padding: 16px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-family: var(--font-body); font-size: 15px; line-height: 1.6; resize: vertical; background: var(--bg-primary); color: var(--text-primary);"></textarea>
            
            <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
                <button onclick="closeModal('journal-modal')" style="padding: 10px 24px; background: var(--bg-primary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Cancel</button>
                <button onclick="saveJournalEntry()" style="padding: 10px 24px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Save Entry</button>
            </div>
        </div>
    </div>

    <!-- ==================== SLEEP TIPS MODAL ==================== -->
    <div id="sleep-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sleep-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 64px; margin-bottom: 12px;">ğŸ’¤</div>
                <h2>Sleep Hygiene Tips</h2>
                <p style="color: var(--text-secondary);">Better sleep leads to better mental health</p>
            </div>
            
            <div style="display: grid; gap: 16px;">
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">â°</span>
                    <div>
                        <strong>Consistent Schedule</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Go to bed and wake up at the same time every day, even on weekends.</p>
                    </div>
                </div>
                
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">ğŸ§˜</span>
                    <div>
                        <strong>Relaxing Routine</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Create a calming bedtime routine: reading, meditation, or gentle stretching.</p>
                    </div>
                </div>
                
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">ğŸŒ¡ï¸</span>
                    <div>
                        <strong>Cool Environment</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Keep your bedroom cool (60-67Â°F / 15-19Â°C) for optimal sleep.</p>
                    </div>
                </div>
                
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">ğŸ“±</span>
                    <div>
                        <strong>No Screens Before Bed</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Avoid screens 1 hour before bedtime. Blue light disrupts melatonin production.</p>
                    </div>
                </div>
                
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">â˜•</span>
                    <div>
                        <strong>Limit Caffeine</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Avoid caffeine after 2 PM. Its effects can last 6-8 hours.</p>
                    </div>
                </div>
                
                <div class="tip-item">
                    <span style="font-size: 24px; margin-right: 12px;">ğŸƒ</span>
                    <div>
                        <strong>Regular Exercise</strong>
                        <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Exercise regularly, but avoid intense workouts 3 hours before bed.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== GRATITUDE MODAL ==================== -->
    <div id="gratitude-modal" class="modal">
        <div class="modal-content small-modal">
            <span class="close" onclick="closeModal('gratitude-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 64px; margin-bottom: 12px;">ğŸ™</div>
                <h2>Gratitude Practice</h2>
                <p style="color: var(--text-secondary);">List three things you're grateful for today</p>
            </div>
            
            <div style="display: grid; gap: 16px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">1. First thing I'm grateful for:</label>
                    <input type="text" id="gratitude-1" placeholder="E.g., My family's support" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">2. Second thing I'm grateful for:</label>
                    <input type="text" id="gratitude-2" placeholder="E.g., A beautiful sunny day" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">3. Third thing I'm grateful for:</label>
                    <input type="text" id="gratitude-3" placeholder="E.g., Good health" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end;">
                <button onclick="closeModal('gratitude-modal')" style="padding: 10px 24px; background: var(--bg-primary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Cancel</button>
                <button onclick="saveGratitude()" style="padding: 10px 24px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Save âœ¨</button>
            </div>
        </div>
    </div>

    <!-- ==================== DASHBOARD MODAL ==================== -->
    <div id="dashboard-modal" class="modal">
        <div class="modal-content large-modal">
            <span class="close" onclick="closeModal('dashboard-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 64px; margin-bottom: 12px;">ğŸ“Š</div>
                <h2>Your Dashboard</h2>
                <p style="color: var(--text-secondary);">Track your mental health journey</p>
            </div>
            
            <div style="display: grid; gap: 24px;">
                <!-- Stats Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 20px; text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ’¬</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--accent); margin-bottom: 4px;" id="total-chats">0</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Total Chats</div>
                    </div>
                    
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 20px; text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--accent); margin-bottom: 4px;" id="total-messages">0</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Messages Sent</div>
                    </div>
                    
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 20px; text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸŒŸ</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--accent); margin-bottom: 4px;" id="streak-days">0</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Day Streak</div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 24px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ“ˆ Recent Activity</h3>
                    <div id="recent-activity" style="display: grid; gap: 12px;">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">Loading your activity...</p>
                    </div>
                </div>
                
                <!-- Mood Tracker -->
                <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 24px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ˜Š How are you feeling today?</h3>
                    <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="saveMood('great')" style="padding: 12px 24px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ˜„</button>
                        <button onclick="saveMood('good')" style="padding: 12px 24px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ™‚</button>
                        <button onclick="saveMood('okay')" style="padding: 12px 24px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ˜</button>
                        <button onclick="saveMood('bad')" style="padding: 12px 24px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ˜”</button>
                        <button onclick="saveMood('terrible')" style="padding: 12px 24px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ğŸ˜¢</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== PROFILE MODAL ==================== -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('profile-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 64px; margin-bottom: 12px;">ğŸ‘¤</div>
                <h2>My Profile</h2>
                <p style="color: var(--text-secondary);">Manage your personal information</p>
            </div>
            
            <div style="display: grid; gap: 20px;">
                <!-- Avatar Section -->
                <div style="text-align: center;">
                    <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--accent); display: inline-flex; align-items: center; justify-content: center; font-size: 48px; margin-bottom: 12px;" id="profile-avatar">
                        ğŸ‘¤
                    </div>
                    <div>
                        <button onclick="openAvatarCustomizer()" style="padding: 8px 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer; font-size: 14px;">Customize Avatar</button>
                    </div>
                </div>
                
                <!-- Profile Form -->
                <div style="display: grid; gap: 16px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Display Name</label>
                        <input type="text" id="profile-display-name" placeholder="Your display name" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Email</label>
                        <input type="email" id="profile-email" placeholder="your.email@example.com" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Username</label>
                        <input type="text" id="profile-username" placeholder="username" disabled style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-secondary); color: var(--text-secondary); cursor: not-allowed;">
                        <small style="color: var(--text-secondary); font-size: 12px;">Username cannot be changed</small>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Bio</label>
                        <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="4" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-size: 14px; background: var(--bg-primary); color: var(--text-primary); resize: vertical; font-family: inherit;"></textarea>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
                    <button onclick="closeModal('profile-modal')" style="padding: 12px 24px; background: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Cancel</button>
                    <button onclick="saveProfile()" style="padding: 12px 24px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SETTINGS MODAL ==================== -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('settings-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 64px; margin-bottom: 12px;">âš™ï¸</div>
                <h2>Settings</h2>
                <p style="color: var(--text-secondary);">Customize your experience</p>
            </div>
            
            <div style="display: grid; gap: 24px;">
                <!-- Appearance -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ¨</span> Appearance
                    </h3>
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Dark Mode</strong>
                                <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Toggle between light and dark theme</p>
                            </div>
                            <label style="position: relative; display: inline-block; width: 60px; height: 30px;">
                                <input type="checkbox" id="dark-mode-toggle" onchange="toggleTheme()" style="opacity: 0; width: 0; height: 0;">
                                <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .4s; border-radius: 30px;"></span>
                                <span style="position: absolute; content: ''; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ””</span> Notifications
                    </h3>
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 16px; display: grid; gap: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Chat Notifications</strong>
                                <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Get notified of new messages</p>
                            </div>
                            <input type="checkbox" id="chat-notifications" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Wellness Reminders</strong>
                                <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Daily wellness activity reminders</p>
                            </div>
                            <input type="checkbox" id="wellness-notifications" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>
                </div>
                
                <!-- Privacy -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ”’</span> Privacy & Security
                    </h3>
                    <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: 16px; display: grid; gap: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Save Chat History</strong>
                                <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Store your conversations</p>
                            </div>
                            <input type="checkbox" id="save-history" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>End-to-End Encryption</strong>
                                <p style="color: var(--text-secondary); margin: 4px 0 0 0; font-size: 14px;">Your chats are always encrypted</p>
                            </div>
                            <span style="color: var(--accent); font-weight: 600;">Enabled</span>
                        </div>
                    </div>
                </div>
                
                <!-- Danger Zone -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; display: flex; align-items: center; gap: 8px; color: #dc3545;">
                        <span>âš ï¸</span> Danger Zone
                    </h3>
                    <div style="background: rgba(220, 53, 69, 0.1); border: 2px solid rgba(220, 53, 69, 0.3); border-radius: var(--radius-lg); padding: 16px; display: grid; gap: 12px;">
                        <button onclick="clearAllChats()" style="padding: 10px 20px; background: transparent; color: #dc3545; border: 2px solid #dc3545; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; width: 100%;">Clear All Chat History</button>
                        <button onclick="deleteAccount()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; width: 100%;">Delete Account</button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeModal('settings-modal')" style="padding: 12px 24px; background: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Close</button>
                    <button onclick="saveSettings()" style="padding: 12px 24px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== AVATAR CUSTOMIZER MODAL ==================== -->
    <div id="avatar-customizer-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('avatar-customizer-modal')">&times;</span>
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="font-size: 64px; margin-bottom: 12px;">âœ¨</div>
                <h2>Customize Your Avatar</h2>
                <p style="color: var(--text-secondary);">Choose your style and colors</p>
            </div>
            
            <div style="display: grid; gap: 24px;">
                <!-- Avatar Preview -->
                <div style="text-align: center; padding: 24px; background: var(--bg-primary); border-radius: var(--radius-lg); border: 2px solid var(--border-color);">
                    <div id="avatar-preview" style="width: 120px; height: 120px; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 64px; transition: all 0.3s ease;">
                        ğŸ‘¤
                    </div>
                </div>
                
                <!-- Avatar Style Selection -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 16px;">Choose Avatar Style</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 12px;">
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ‘¤')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ‘¤</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ˜Š')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ˜Š</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ™‚')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ™‚</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ˜„')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ˜„</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ¤“')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ¤“</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ˜')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ˜</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸŒŸ')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸŒŸ</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸŒ¸')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸŒ¸</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸŒŠ')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸŒŠ</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸƒ')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸƒ</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ¦‹')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ¦‹</button>
                        <button class="avatar-option" onclick="selectAvatarStyle('ğŸ¨')" style="padding: 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 32px; cursor: pointer; transition: all 0.2s;">ğŸ¨</button>
                    </div>
                </div>
                
                <!-- Background Color Selection -->
                <div>
                    <h3 style="margin: 0 0 16px 0; font-size: 16px;">Choose Background Color</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 12px;">
                        <button onclick="selectAvatarColor('#2D5A3D')" style="width: 60px; height: 60px; background: #2D5A3D; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#4A7C59')" style="width: 60px; height: 60px; background: #4A7C59; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#6B9B7A')" style="width: 60px; height: 60px; background: #6B9B7A; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#B8845A')" style="width: 60px; height: 60px; background: #B8845A; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#D4A574')" style="width: 60px; height: 60px; background: #D4A574; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#7FA99B')" style="width: 60px; height: 60px; background: #7FA99B; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#9B7FA9')" style="width: 60px; height: 60px; background: #9B7FA9; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                        <button onclick="selectAvatarColor('#A97F9B')" style="width: 60px; height: 60px; background: #A97F9B; border: 3px solid var(--border-color); border-radius: 50%; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
                    <button onclick="closeModal('avatar-customizer-modal')" style="padding: 12px 24px; background: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Cancel</button>
                    <button onclick="saveCustomAvatar()" style="padding: 12px 24px; background: var(--accent); color: white; border: none; border-radius: var(--radius-lg); font-weight: 600; cursor: pointer;">Apply Avatar âœ¨</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script src="/static/js/app.js"></script>
</body>
</html>
```